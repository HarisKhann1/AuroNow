{% load static %}
<form
  action="{% url 'search_results' %}"
  method="GET"
  >
  <!-- Search Bar -->
  <main class="bg-transparent text-white border shadow-md rounded-lg lg:rounded-full px-4 py-2 w-full max-w-3xl mx-auto">

    <!-- Laptop/Desktop Layout -->
    <div id='desktop' class="hidden lg:flex lg:items-center lg:gap-0">
    
      <!--categories  -->
      <select name="category" class="bg-transparent border-none focus:outline-none appearance-none w-auto focus:ring-0 hover:text-gray-200">
        <option class="text-black " value="">Category</option>
        {% for cat in categories %}
        <option class="text-black " value="{{ cat }}" {% if request.GET.category == cat %}selected{% endif %}>
          {{ cat }}
        </option>
        {% endfor %}
      </select>
      <span class="text-gray-500">|</span>

      <!--Name Input  -->
      <input 
        type="text" 
        name="shop_name" 
        placeholder="Name" 
        value="{{ request.GET.shop_name }}"
        class="bg-transparent placeholder:text-white outline-none border-none text-medium flex-grow focus:ring-0 text-white
           [&:-webkit-autofill]:bg-transparent [&:-webkit-autofill]:text-white"
      />
      <span class="text-gray-500">|</span>

      <!-- Location -->
      <select name="city" class="bg-transparent  outline-none text-medium border-none appearance-none w-auto focus:ring-0 hover:text-gray-200">
        <option  class="text-black" value="">Location</option>
        {% for city in cities %}
        <option  class="text-black" value="{{ city }}" {% if request.GET.city == city %}selected{% endif %}>
          {{ city }}
        </option>
        {% endfor %}
      </select>
      <span class="text-gray-500">|</span>
    
      <!--Price -->
      <select name="price" class="bg-transparent outline-none text-medium border-none appearance-none w-auto focus:ring-0 hover:text-gray-200">
        <option  class="text-black" value="">Price</option>
        {% for price in price_ranges %}
        <option class="text-black" value="{{ price }}" {% if request.GET.price == price %}selected{% endif %}>
          {{ price }}
        </option>
        {% endfor %}
      </select>
      <!-- search button -->
     <button type="submit" class="bg-primary-color text-gray-700 px-4 py-2 rounded-full hover:bg-primary-hover-color -mr-2">
        Search
      </button>
    </div>


      <!-- Tablet Layout -->
    <div id='tablet' class="hidden md:flex md:flex-col lg:hidden gap-3">
      <div class="grid grid-cols-2 gap-3">
        <!--categories  -->
        <select name="category" class="bg-transparent focus:outline-none text-medium border-none appearance-none w-full focus:ring-0 hover:text-gray-200">
          <option value="" class="text-black">Category</option>
          {% for cat in categories %}
          <option class="text-black" value="{{ cat }}" {% if request.GET.category == cat %}selected{% endif %}>
            {{ cat }}
          </option>
          {% endfor %}
        </select>

        <!--Name Input  -->
        <input type="text" name="shop_name" placeholder="Name" value="{{ request.GET.shop_name }}"
          class="bg-transparent placeholder:text-white outline-none border-none text-medium w-full  focus:ring-0" />

          <!-- Location -->
        <select name="city" class="bg-transparent focus:outline-none text-medium border-none appearance-none w-full focus:ring-0 hover:text-gray-200">
          <option  class="text-black" value="">Location</option>
          {% for city in cities %}
          <option class="text-black" value="{{ city }}" {% if request.GET.city == city %}selected{% endif %}>
            {{ city }}
          </option>
          {% endfor %}
        </select>

        <!--Price -->
        <select name="price" class="bg-transparent focus:outline-none text-medium border-none appearance-none w-full focus:ring-0 hover:text-gray-200">
          <option class="text-black" value="">Price</option>
          {% for price in price_ranges %}
          <option class="text-black" value="{{ price }}" {% if request.GET.price == price %}selected{% endif %}>
            {{ price }}
          </option>
          {% endfor %}
        </select>
      </div>
      <!-- search button -->

      <button type="submit" class="bg-primary-color text-gray-700 px-4 py-2 rounded-lg hover:bg-primary-hover-color w-full md:w-1/2 mx-auto">
        Search
      </button>
    </div>
    <!-- Mobile Layout -->
    <div id='mobile' class="flex flex-col gap-2 md:hidden">
      <!--categories  -->
      <select name="category" class="bg-transparent focus:outline-none text-sm border-none appearance-none w-full py-2 focus:ring-0 hover:text-gray-200">
        <option class="text-black" value="" >Category</option>
        {% for cat in categories %}
        <option  class="text-black" class="text-black" value="{{ cat }}" {% if request.GET.category == cat %}selected{% endif %}>
          {{ cat }}
        </option>
        {% endfor %}
      </select>

      <!--Name Input  -->
      <input type="text" name="shop_name" placeholder="Name" value="{{ request.GET.shop_name }}"
        class="bg-transparent placeholder:text-white outline-none border-none text-medium w-full focus:ring-0" />

      <!-- Location -->
      <select name="city" class="bg-transparent focus:outline-none text-sm border-none appearance-none w-full py-2 focus:ring-0 hover:text-gray-200">
        <option class="text-black" value="">Location</option>
        {% for city in cities %}
        <option class="text-black" value="{{ city }}" {% if request.GET.city == city %}selected{% endif %}>
          {{ city }}
        </option>
        {% endfor %}
      </select>

      <!--Price -->
      <select name="price" class="bg-transparent focus:outline-none text-sm border-none appearance-none w-full py-2 focus:ring-0 hover:text-gray-200">
        <option class="text-black" value="">Price</option>
        {% for price in price_ranges %}
        <option class="text-black" value="{{ price }}" {% if request.GET.price == price %}selected{% endif %}>
          {{ price }}
        </option>
        {% endfor %}
      </select>

      <!-- search button -->
      <button type="submit" class="bg-primary-color text-gray-700 px-4 py-2 rounded-lg hover:bg-primary-hover-color w-full mt-2 focus:ring-0 hover:text-gray-200">
        Search
      </button>
    </div> 
  </main>
  
</form>
<!-- Near Shops -->
<div class="flex items-center lg:px-6 py-2 w-full max-w-3xl mx-auto  ">
  <div class = "transition duration-300  hover:scale-105 flex items-center">
    <img class="inline-block w-6 h-6 " src="{% static 'icons/location-icon.png' %}" alt="">
    <button id="near-shops-btn" type='button' class="inline-block text-white">Near Shops</button>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    function updateFormInputs() {
      const desktopForm = document.querySelector("#desktop");
      const tabletForm = document.querySelector("#tablet");
      const mobileForm = document.querySelector("#mobile");
  
      let activeForm = null;
  
      if (window.innerWidth >= 1024) {
        activeForm = desktopForm;
      } else if (window.innerWidth >= 768) {
        activeForm = tabletForm;
      } else {
        activeForm = mobileForm;
      }
  
      if (!activeForm) return; // ðŸ›‘ Stop if no active form is found
  
      document.querySelectorAll("select, input").forEach((el) => {
        if (activeForm.contains(el)) {
          el.removeAttribute("disabled");
        } else {
          el.setAttribute("disabled", "true");
        }
      });
    }
  
    updateFormInputs();
    window.addEventListener("resize", updateFormInputs);
  });


  // get user lati & longi 
   document.getElementById('near-shops-btn').addEventListener('click', function () {
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(function (position) {
        const lat = position.coords.latitude;
        const lon = position.coords.longitude;
        const url = new URL("{% url 'search_results' %}", window.location.origin);
        url.searchParams.set('lat', lat);
        url.searchParams.set('lon', lon);
        window.location.href = url.toString();
      }, function (error) {
        alert("Unable to retrieve your location.");
      });
    } else {
      alert("Geolocation is not supported by your browser.");
    }
  });

</script>

